
---

## IANA
***[Internet Assigned Numbers Autority](https://iana.org)***

---
IANA é responsável por coordenar alguns dos elementos chaves para o funcionamento da internet
- Gerenciamento dos root servers (Domain Names)
- Coordenação de números IP e ASN (Autonomous System Numbers)
- Registros de Protocolos

#### RIRs (Regional Internet Registries)
 São registros que determinam e fazem a distribuição dos blocos de IP's e ASN's da internet para cada localidade no globo. 
 *LACNIC é o registro que cuida da américa latina e ilhas do Caribe*

#### Netblock x ASN

-> **Netblock** : Um range ou conjunto de IP's
-> **ASN (Autonomous System)** : Um ou mais blocos de IP's de rede sob o mesmo administrador

Exemplos: 
Se a empresa precisa de um range com 12 IP's ela pode comprar um netblock
Se a empresa precisa de centenas de endereços IP's ela pode comprar um ASN

## WHOIS
WHOIS é um protocolo que roda na porta 43 que pode nos dar informações sobre o dono do ip

A própia iana apresenta um WHOIS, [IANA-WHOIS](https://iana.org/whois), onde nela você poderá ir se redirecionando de refer's em refer's onde conseguirá informações de como quem vendeu, qual o range que comprou, CPF/CNPJ do comprador, etc.

A pesquisa também pode ser feita via linha de comando da seguinte maneira:
``` whois (dominio/ip que deseja saber) ```


## RDAP
***Registration Data Acess Protocol***
[rdap client](https://client.rdap.org) : Site para consulta usando o RDAP

---

É um protocolo criado para resolver alguns dos problemas dentro do whois, como a padronização, onde cada servidor implementa de uma maneira. Já no RDAP a resposta é padronizada sendo enviada no padrão JSON, facilitando o trabalho e o tratameto da resposta.



## Pesquisa por IP

Descobrir se o cliente tem um ASN ou netblock, porém em alguns dos casos o cliente usa uma espécie de servidor hosteado ou VPN. Veremos como passar por cima disso

Exemplo:
``` bash
host vivo.com.br
# nos devolve o ip da vivo (cliente hipotético)

whois (ip da vivo) | egrep "inetnum|aut-num"
#fará a busca do ip da vivo usando o whois e irá filtrar nos dando o seu range de ip's e caso possua, o seu ASN
```
*Tomar cuidado para clientes que possuem algum serviço contratado que pode fa
zer você se confundir com o range dos ip's*

## Pesquisa por BGP
***Border Gateway Protocol***

Sites que trazem informações sobre as interligações dos ASN/noteblocks pesquisados 
[bgp view](https://bgpview.io)
[bgp net](https://bgp.he.net) 


## Pesquisa no Shodan
[Shodan](https://www.shodan.io)

O shodan é uma search engine para aparelhos conectados com a internet, podendo oferecer informações valiosas ou máquinas vulneráveis

--Operadores--
- hostname: -> busca no site especificado   
- os: -> busca por sistema operacional
- port: -> busca por porta
- ip: -> busca por ip
- net: -> busca por rede
- country: -> busca por país
- city: -> busca por cidade
- geo: -> busca por geolocalização
- org: -> busca por uma organização
- "  " -> busca por algum termo

## Pesquisa no Censys
[Censys](https://censys.io)

Site parecido com o shodan, diferenciando na possibilidade de filtros de pesquisas

## Pesquisa por DNS

Registros DNS:
![[Pasted image 20250218100826.png]]

A ferramenta que vamos utilizar vai ser a *host*
Utilização:
``` bash
host -t (Registro que deseja) (Dominio que quer pesquisa)
```


## Transferência de Zona

Geralmente todos os servidores DNS possuem no minimo 2 servidores, onde um atua como um backup, porém quando o backup está desatualizado, os servidores precisam fazer uma ação chamada **Transferência de zona** para realizar a atualização do servidor backup para caso o servidor primário pare. 
*Curiosidade: A transferencia de zona funciona no protocolo DNS na porta 53/TCP enquanto as consultas DNS ocorrem na porta 53/UDP*

#### Como pode ser usado isso para ataques?

 Podemos utilizar o comando *host -l "servidor" "nome específico do name server"* que força uma conexão via o protocolo AXFR (transferência de zona), fazendo isso e obtendo sucesso é uma falha grave pois não é uma boa prática permitir que qualquer um consiga extrair os seus dados resolvedores de nomes de seus servidores .

Um pequeno script para automatizar o processo de testar qual dos serivdores pode permitir tal consulta:
``` shell

	for server in $(host -t ns businesscorp.com.br | cut -d " " -f4); do host -l -a businesscorp.com.br $server; done

```





## Script para brute force de DNS
Já existe ferramentas que fazem esta função, porém apenas para ter um "autoral"
Ferramenta muito utilizada: ***Gobuster***

Script:
```bash


	for palavra in $(cat lista.txt); do host $palavra.bussinescorp.com.br; done | grep -v "NXDOMAIN"
#lista.txt pode ser qualquer banco de palavras que você tenha, será utilizado para fazer a descoberta dos respectivos dominios
#grep -v "NXDOMAIN" para nao aparecer os nomes que nao existem

```


Podemos criar um Script Reverso para isso tambem, onde podemos descobrir o nome dos domínios/sub-domínios da rede de ip  que faremos a pesquisa.

``` shell

for ip in $(seq (range de ip da empresa)); do host (ip da empresa).$ip; done
```

Técnica que pode ser utilizada após descobrir um bloco de ip do cliente, que assim você pode descobrir todos os domínios mesmo que tenham nomes "diferentes" como kajdhakjdh.dominio.com.br 



## SPF
*Sender Policy Framework*

[email spoofer](https://emkei.cz) : site para realizar o spoofing com um email falso

O registro SPF visa identificar quais servidores estão autorizados a enviar e-mails em nome do seu domínio, isto é necessário para evitar que qualquer pessoa possa enviar e-mails através do seu domínio *(email spoofing)* 

Exemplos de configuração:
![[Pasted image 20250218111318.png]]

Para fazer a checagem de como está configurado o SPF no serivdor alvo basta usar o comando *host -t txt (dominio)* que ele irá lhe mostrar ou a configuração do spf ou não irá mostrar nada (indicando que está sem nenhuma restrição no registro)


## Subdomain Takeover

 Uma falha grave que permite que um atacante consegue tomar controle de um sub domínio da empresa, o que permite que você faça um cenário de fraude, um ataque específico para os clientes da empresa. Representando um grave ameaça a integridade da empresa

---
##### Como funciona:
![[Pasted image 20250218114853.png]]
CNAME é uma função que faz o redirecionamento do site

O perigo nesse caso mora onde o serviço dev.businesscorp.com.br está fazendo um CNAME para um serviço que está desativado,migrou,etc.

##### O problema:
Como o cliente desativou o serviço, agora o dominio do s3 está livre, logo qualquer pessoa pode comprar este dominio, fazendo com que você obtenha controle do servidor do alvo, hosteando uma página falsa de phishing, um malware, etc.
![[Pasted image 20250218115254.png]]

##### Como detectar:
Utilizar o comando ***host -t cname (BRUTEFORCE DNS).businesscorp.com.br***
*Achou um dominio que possui um cname:*
**dev.businesscorp.com.br APONTA PARA businesscorp.s3.amazon.com**

Endereço resolvido está ativo?(businesscorp.s3.amazon.com)

--> SIM -> Não vulnerável
--> NÃO -> É possível registrar? -> SIM -> Vulnerável
                            --> NÃO -> Não Vulnerável

###### Criando um script para o Subdomain takeover

```shell
#!/bin/bash
#fazer a pesquisa para achar hosts que fazem o alias
for palavra in $(cat lista.txt);do
host -t cname $palavra.$1 | grep  "alias for"
done
```

###### Obtendo o controle:

Fazendo a busca hipotética achamos um serviço da amazon que não está mais online, o que nos permite criar um outro s3 bucket com o mesmo nome de domínio, permitindo que obtenhamos o controle do subdominio

*The specified bucket does not exist*
![[Pasted image 20250218122913.png]]
Criando um bucket no site da amazon e colocando o mesmo nome, podemos fazer com que ele aponte diretamente para o nosso bucket e assim controlemos o subdomínio.
![[Pasted image 20250218123229.png]]


## Outras ferramentas para o DNS

- dig : Ferramenta parecidoa com o host
- dnsenum : Ferramenta para fazer a enumeração de dns, além de inúmeras outras aplicações 
- dnsrecon : Ferramenta para reazliar a enumeração de dns
- fierce : Ferramenta que tenta fazer brute force e transferencia de zona


## Pesquisa passiva 

[virustotal](https://www.virustotal.com/gui/home/upload)

[dnsdumpster](https://dnsdumpster.com)

[securitytrails](https://securitytrails.com)

## Coleta através de certificados digitais

Voce consegue fazer a pesquisa em cima de certificados emitidos em cima de um site mostrando a empresa que realizou o certificado e mantém ele, e em um desses certificados pode ser mostrado algum sub-dominio que acabou passando pelos scans de dns

]